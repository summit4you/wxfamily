(function(d){var c="canvasResize",b={newsize:function(g,l,k,i,j){if(g==0&&l==0){return{width:k,height:i};}else{if((k&&g>k)||(i&&l>i)){var f=g/l;if((f>=1||i==0)&&k&&!j){g=k;
l=(k/f)>>0;}else{if(j&&f<=(k/i)){g=k;l=(k/f)>>0;}else{g=(i*f)>>0;l=i;}}}return{width:g,height:l};}},dataURLtoBlob:function(j){var l=j.split(",")[0].split(":")[1].split(";")[0];
var k=atob(j.split(",")[1]);var h=new ArrayBuffer(k.length);var g=new Uint8Array(h);for(var m=0;m<k.length;m++){g[m]=k.charCodeAt(m);}var f=(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);
if(f){f=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();f.append(h);return f.getBlob(l);}else{f=new Blob([h],{type:(l)});return f;
}},detectSubsampling:function(j){var i=j.width,g=j.height;if(i*g>1024*1024){var h=document.createElement("canvas");h.width=h.height=1;var f=h.getContext("2d");
f.drawImage(j,-i+1,0);return f.getImageData(0,0,1,1).data[3]===0;}else{return false;}},transformCoordinate:function(h,i,g,j){switch(j){case 5:case 6:case 7:case 8:h.width=g;
h.height=i;break;default:h.width=i;h.height=g;}var f=h.getContext("2d");switch(j){case 1:break;case 2:f.translate(i,0);f.scale(-1,1);break;case 3:f.translate(i,g);
f.rotate(Math.PI);break;case 4:f.translate(0,g);f.scale(1,-1);break;case 5:f.rotate(0.5*Math.PI);f.scale(1,-1);break;case 6:f.rotate(0.5*Math.PI);f.translate(0,-g);
break;case 7:f.rotate(0.5*Math.PI);f.translate(i,-g);f.scale(-1,1);break;case 8:f.rotate(-0.5*Math.PI);f.translate(-i,0);break;default:break;}},detectVerticalSquash:function(l,o,f){var j=document.createElement("canvas");
j.width=1;j.height=f;var h=j.getContext("2d");h.drawImage(l,0,0);var g=h.getImageData(0,0,1,f).data;var n=0;var i=f;var k=f;while(k>n){var m=g[(k-1)*4+3];
if(m===0){i=k;}else{n=k;}k=(i+n)>>1;}return k/f;},callback:function(f){return f;}},e={width:300,height:0,crop:false,quality:80,callback:b.callback};function a(f,g){this.file=f;
this.options=d.extend({},e,g);this._defaults=e;this._name=c;this.init();}a.prototype={init:function(){var h=this;var f=this.file;var g=new FileReader();
g.onloadend=function(i){var j=i.target.result;var k=new Image();k.onload=function(l){d(k).exifLoadFromDataURL(function(){var p=d(k).exif("Orientation")[0];
var n=(p>=5&&p<=8)?b.newsize(k.height,k.width,h.options.width,h.options.height,h.options.crop):b.newsize(k.width,k.height,h.options.width,h.options.height,h.options.crop);
var H=k.width,B=k.height;var s=n.width,y=n.height;var o=document.createElement("canvas");var z=o.getContext("2d");z.save();b.transformCoordinate(o,s,y,p);
if(b.detectSubsampling(k)){H/=2;B/=2;}var G=1024;var w=document.createElement("canvas");w.width=w.height=G;var D=w.getContext("2d");var t=b.detectVerticalSquash(k,H,B);
var v=0;while(v<B){var F=v+G>B?B-v:G;var C=0;while(C<H){var m=C+G>H?H-C:G;D.clearRect(0,0,G,G);D.drawImage(k,-C,-v);var x=Math.floor(C*s/H);var u=Math.ceil(m*s/H);
var E=Math.floor(v*y/B/t);var r=Math.ceil(F*y/B/t);z.drawImage(w,0,0,m,F,x,E,u,r);C+=G;}v+=G;}z.restore();w=D=null;var A=document.createElement("canvas");
A.width=s;A.height=y;newctx=A.getContext("2d");newctx.drawImage(o,0,0,s,y);var q=A.toDataURL("image/jpeg",(h.options.quality*0.01));h.options.callback(q,s,y);
});};k.src=j;};g.readAsDataURL(f);}};d[c]=function(f,g){if(typeof f=="string"){return b[f](g);}else{new a(f,g);}};})(jQuery);