(function(d){var c="canvasResize",a={newsize:function(g,j,f,i,l){if(g==0&&j==0){return{width:f,height:i};}else{if((f&&g>f)||(i&&j>i)){var k=g/j;if((k>=1||i==0)&&f&&!l){g=f;
j=(f/k)>>0;}else{if(l&&k<=(f/i)){g=f;j=(f/k)>>0;}else{g=(i*k)>>0;j=i;}}}return{width:g,height:j};}},dataURLtoBlob:function(k){var f=k.split(",")[0].split(":")[1].split(";")[0];
var m=atob(k.split(",")[1]);var j=new ArrayBuffer(m.length);var g=new Uint8Array(j);for(var h=0;h<m.length;h++){g[h]=m.charCodeAt(h);}var l=(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);
if(l){l=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();l.append(j);return l.getBlob(f);}else{l=new Blob([j],{type:(f)});return l;
}},detectSubsampling:function(h){var g=h.width,j=h.height;if(g*j>1024*1024){var i=document.createElement("canvas");i.width=i.height=1;var f=i.getContext("2d");
f.drawImage(h,-g+1,0);return f.getImageData(0,0,1,1).data[3]===0;}else{return false;}},transformCoordinate:function(i,j,f,h){switch(h){case 5:case 6:case 7:case 8:i.width=f;
i.height=j;break;default:i.width=j;i.height=f;}var g=i.getContext("2d");switch(h){case 1:break;case 2:g.translate(j,0);g.scale(-1,1);break;case 3:g.translate(j,f);
g.rotate(Math.PI);break;case 4:g.translate(0,f);g.scale(1,-1);break;case 5:g.rotate(0.5*Math.PI);g.scale(1,-1);break;case 6:g.rotate(0.5*Math.PI);g.translate(0,-f);
break;case 7:g.rotate(0.5*Math.PI);g.translate(j,-f);g.scale(-1,1);break;case 8:g.rotate(-0.5*Math.PI);g.translate(-j,0);break;default:break;}},detectVerticalSquash:function(j,g,n){var f=document.createElement("canvas");
f.width=1;f.height=n;var o=f.getContext("2d");o.drawImage(j,0,0);var i=o.getImageData(0,0,1,n).data;var l=0;var k=n;var m=n;while(m>l){var h=i[(m-1)*4+3];
if(h===0){k=m;}else{l=m;}m=(k+l)>>1;}return m/n;},callback:function(f){return f;}},e={width:300,height:0,crop:false,quality:80,callback:a.callback};function b(g,f){this.file=g;
this.options=d.extend({},e,f);this._defaults=e;this._name=c;this.init();}b.prototype={init:function(){var h=this;var g=this.file;var f=new FileReader();
f.onloadend=function(j){var k=j.target.result;var i=new Image();i.onload=function(l){d(i).exifLoadFromDataURL(function(){var o=d(i).exif("Orientation")[0];
var x=(o>=5&&o<=8)?a.newsize(i.height,i.width,h.options.width,h.options.height,h.options.crop):a.newsize(i.width,i.height,h.options.width,h.options.height,h.options.crop);
var q=i.width,v=i.height;var B=x.width,y=x.height;var n=document.createElement("canvas");var C=n.getContext("2d");C.save();a.transformCoordinate(n,B,y,o);
if(a.detectSubsampling(i)){q/=2;v/=2;}var F=1024;var m=document.createElement("canvas");m.width=m.height=F;var p=m.getContext("2d");var D=a.detectVerticalSquash(i,q,v);
var w=0;while(w<v){var G=w+F>v?v-w:F;var z=0;while(z<q){var A=z+F>q?q-z:F;p.clearRect(0,0,F,F);p.drawImage(i,-z,-w);var t=Math.floor(z*B/q);var u=Math.ceil(A*B/q);
var s=Math.floor(w*y/v/D);var E=Math.ceil(G*y/v/D);C.drawImage(m,0,0,A,G,t,s,u,E);z+=F;}w+=F;}C.restore();m=p=null;var r=document.createElement("canvas");
r.width=B;r.height=y;newctx=r.getContext("2d");newctx.drawImage(n,0,0,B,y);var H=r.toDataURL("image/jpeg",(h.options.quality*0.01));h.options.callback(H,B,y);
});};if(k&&k.match(/^data:base64/)){i.src=k.replace(/^data:base64/,"data:image/jpeg;base64");}else{i.src=k;}};f.readAsDataURL(g);}};d[c]=function(g,f){if(typeof g=="string"){return a[g](f);
}else{new b(g,f);}};})(jQuery);