(function(d){var b="canvasResize",a={newsize:function(f,l,i,k,g){if((i&&f>i)||(k&&l>k)){var j=f/l;if((j>=1||k==0)&&i&&!g){f=i;l=(i/j)>>0;}else{if(g&&j<=(i/k)){f=i;
l=(i/j)>>0;}else{f=(k*j)>>0;l=k;}}}return{width:f,height:l};},dataURLtoBlob:function(h){var m=h.split(",")[0].split(":")[1].split(";")[0];var k=atob(h.split(",")[1]);
var g=new ArrayBuffer(k.length);var l=new Uint8Array(g);for(var j=0;j<k.length;j++){l[j]=k.charCodeAt(j);}var f=(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);
if(f){f=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();f.append(g);return f.getBlob(m);}else{f=new Blob([g],{type:(m)});return f;
}},detectSubsampling:function(h){var g=h.width,i=h.height;if(g*i>1024*1024){var j=document.createElement("canvas");j.width=j.height=1;var f=j.getContext("2d");
f.drawImage(h,-g+1,0);return f.getImageData(0,0,1,1).data[3]===0;}else{return false;}},transformCoordinate:function(j,i,h,g){switch(g){case 5:case 6:case 7:case 8:j.width=h;
j.height=i;break;default:j.width=i;j.height=h;}var f=j.getContext("2d");switch(g){case 1:break;case 2:f.translate(i,0);f.scale(-1,1);break;case 3:f.translate(i,h);
f.rotate(Math.PI);break;case 4:f.translate(0,h);f.scale(1,-1);break;case 5:f.rotate(0.5*Math.PI);f.scale(1,-1);break;case 6:f.rotate(0.5*Math.PI);f.translate(0,-h);
break;case 7:f.rotate(0.5*Math.PI);f.translate(i,-h);f.scale(-1,1);break;case 8:f.rotate(-0.5*Math.PI);f.translate(-i,0);break;default:break;}},detectVerticalSquash:function(j,k,g){var o=document.createElement("canvas");
o.width=1;o.height=g;var l=o.getContext("2d");l.drawImage(j,0,0);var f=l.getImageData(0,0,1,g).data;var m=0;var h=g;var n=g;while(n>m){var i=f[(n-1)*4+3];
if(i===0){h=n;}else{m=n;}n=(h+m)>>1;}return n/g;},callback:function(f){return f;}},c={width:300,height:0,crop:false,quality:80,callback:a.callback};function e(f,g){this.file=f;
this.options=d.extend({},c,g);this._defaults=c;this._name=b;this.init();}e.prototype={init:function(){var h=this;var f=this.file;var g=new FileReader();
g.onloadend=function(j){var k=j.target.result;var i=new Image();i.onload=function(l){d(i).exifLoadFromDataURL(function(){var u=d(i).exif("Orientation")[0];
var y=(u>=5&&u<=8)?a.newsize(i.height,i.width,h.options.width,h.options.height,h.options.crop):a.newsize(i.width,i.height,h.options.width,h.options.height,h.options.crop);
var B=i.width,z=i.height;var A=y.width,C=y.height;var t=document.createElement("canvas");var n=t.getContext("2d");n.save();a.transformCoordinate(t,A,C,u);
if(a.detectSubsampling(i)){B/=2;z/=2;}var p=1024;var m=document.createElement("canvas");m.width=m.height=p;var o=m.getContext("2d");var D=a.detectVerticalSquash(i,B,z);
var w=0;while(w<z){var q=w+p>z?z-w:p;var F=0;while(F<B){var s=F+p>B?B-F:p;o.clearRect(0,0,p,p);o.drawImage(i,-F,-w);var G=Math.floor(F*A/B);var v=Math.ceil(s*A/B);
var H=Math.floor(w*C/z/D);var r=Math.ceil(q*C/z/D);n.drawImage(m,0,0,s,q,G,H,v,r);F+=p;}w+=p;}n.restore();m=o=null;var E=document.createElement("canvas");
E.width=A;E.height=C;newctx=E.getContext("2d");newctx.drawImage(t,0,0,A,C);var x=E.toDataURL("image/jpeg",(h.options.quality*0.01));h.options.callback(x,A,C);
});};i.src=k;};g.readAsDataURL(f);}};d[b]=function(f,g){if(typeof f=="string"){return a[f](g);}else{new e(f,g);}};})(jQuery);