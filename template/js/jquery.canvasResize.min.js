(function(e){var d="canvasResize",a={newsize:function(l,g,f,k,j){if(l==0&&g==0){return{width:f,height:k};}if((f&&l>f)||(k&&g>k)){var i=l/g;if((i>=1||k==0)&&f&&!j){l=f;
g=(f/i)>>0;}else{if(j&&i<=(f/k)){l=f;g=(f/i)>>0;}else{l=(k*i)>>0;g=k;}}}return{width:l,height:g};},dataURLtoBlob:function(l){var g=l.split(",")[0].split(":")[1].split(";")[0];
var m=atob(l.split(",")[1]);var k=new ArrayBuffer(m.length);var f=new Uint8Array(k);for(var h=0;h<m.length;h++){f[h]=m.charCodeAt(h);}var j=(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);
if(j){j=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();j.append(k);return j.getBlob(g);}else{j=new Blob([k],{type:(g)});return j;
}},detectSubsampling:function(h){var f=h.width,i=h.height;if(f*i>1024*1024){var j=document.createElement("canvas");j.width=j.height=1;var g=j.getContext("2d");
g.drawImage(h,-f+1,0);return g.getImageData(0,0,1,1).data[3]===0;}else{return false;}},transformCoordinate:function(i,g,j,f){switch(f){case 5:case 6:case 7:case 8:i.width=j;
i.height=g;break;default:i.width=g;i.height=j;}var h=i.getContext("2d");switch(f){case 1:break;case 2:h.translate(g,0);h.scale(-1,1);break;case 3:h.translate(g,j);
h.rotate(Math.PI);break;case 4:h.translate(0,j);h.scale(1,-1);break;case 5:h.rotate(0.5*Math.PI);h.scale(1,-1);break;case 6:h.rotate(0.5*Math.PI);h.translate(0,-j);
break;case 7:h.rotate(0.5*Math.PI);h.translate(g,-j);h.scale(-1,1);break;case 8:h.rotate(-0.5*Math.PI);h.translate(-g,0);break;default:break;}},detectVerticalSquash:function(l,m,j){var n=document.createElement("canvas");
n.width=1;n.height=j;var o=n.getContext("2d");o.drawImage(l,0,0);var g=o.getImageData(0,0,1,j).data;var f=0;var i=j;var k=j;while(k>f){var h=g[(k-1)*4+3];
if(h===0){i=k;}else{f=k;}k=(i+f)>>1;}return k/j;},callback:function(f){return f;}},b={width:300,height:0,crop:false,quality:80,callback:a.callback};function c(f,g){this.file=f;
this.options=e.extend({},b,g);this._defaults=b;this._name=d;this.init();}c.prototype={init:function(){var h=this;var f=this.file;var g=new FileReader();
g.onloadend=function(k){var j=k.target.result;var i=new Image();i.onload=function(l){e(i).exifLoadFromDataURL(function(){var p=e(i).exif("Orientation")[0];
var G=(p>=5&&p<=8)?a.newsize(i.height,i.width,h.options.width,h.options.height,h.options.crop):a.newsize(i.width,i.height,h.options.width,h.options.height,h.options.crop);
var w=i.width,E=i.height;var C=G.width,m=G.height;var D=document.createElement("canvas");var y=D.getContext("2d");y.save();a.transformCoordinate(D,C,m,p);
if(a.detectSubsampling(i)){w/=2;E/=2;}var A=1024;var z=document.createElement("canvas");z.width=z.height=A;var o=z.getContext("2d");var q=a.detectVerticalSquash(i,w,E);
var H=0;while(H<E){var v=H+A>E?E-H:A;var B=0;while(B<w){var t=B+A>w?w-B:A;o.clearRect(0,0,A,A);o.drawImage(i,-B,-H);var u=Math.floor(B*C/w);var x=Math.ceil(t*C/w);
var n=Math.floor(H*m/E/q);var r=Math.ceil(v*m/E/q);y.drawImage(z,0,0,t,v,u,n,x,r);B+=A;}H+=A;}y.restore();z=o=null;var F=document.createElement("canvas");
F.width=C;F.height=m;newctx=F.getContext("2d");newctx.drawImage(D,0,0,C,m);var s=F.toDataURL("image/jpeg",(h.options.quality*0.01));h.options.callback(s,C,m);
});};i.src=j;};g.readAsDataURL(f);}};e[d]=function(f,g){if(typeof f=="string"){return a[f](g);}else{new c(f,g);}};})(jQuery);