function iOSversion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var a=(navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3]||0,10)];
}}function pubilchPhoto(c,b,d,a){$.ajax({dataType:"jsonp",url:"http://www.familyday.com.cn/dapi/cp.php?ac=photo&m_auth="+encodeURIComponent(a)+"&title["+c+"]=&message="+encodeURIComponent(b)+"&friend=0&come=wx&makefeed=1&photosubmit=1&tags="+encodeURIComponent(d),success:function(e){if(e.error==0){e=e.data;
alert("提交成功，获得了"+e.credit+"点积分");window.location.href="http://www.familyday.com.cn/wx/wx.php?do=feed&wxkey=$_GET[wxkey]";}else{alert(e.msg);}}});}function publicBlog(d,b,c,a){$.ajax({dataType:"jsonp",url:"http://www.familyday.com.cn/dapi/cp.php?ac=blog&m_auth="+encodeURIComponent(a)+"&message="+encodeURIComponent(b)+"&friend=0&come=wx&makefeed=1&blogsubmit=1&tags="+encodeURIComponent(c)+"&subject="+encodeURIComponent(d),success:function(e){if(e.error==0){e=e.data;
alert("提交成功，获得了"+e.credit+"点积分");window.location.href="http://www.familyday.com.cn/wx/wx.php?do=feed&wxkey=$_GET[wxkey]";}else{alert(e.msg);}}});}function submitBlog(){var a=/^[\s]{0,}$/g;
if(!a.test($("#message").val())){publicBlog($("#subject").val(),$("#message").val(),$("#tagname").val(),$("#auth").val());}else{alert("至少写一点东西！");}}function submitPhoto(){var a=/^[\s]{0,}$/g;
if(!a.test($("#message").val())){pubilchPhoto($("#picid").val(),$("#message").val(),$("#tagname").val(),$("#auth").val());}else{alert("至少写一点东西！");}}$(function(){$("#auth").val(localStorage.getItem("auth"));
$(".msg-image").click(function(){ver=iOSversion();if(typeof(ver)!="undefined"&&ver!=null){if(ver[0]<6){alert("ios系统当前仅6.0以上的系统支持上传图片,请更新你的系统");}else{$("input[name=Filedata]").trigger("click");
}}else{$("input[name=Filedata]").trigger("click");}});$("input[name=Filedata]").change(function(a){var b=a.target.files[0];$("#pic").remove();$.canvasResize(b,{width:640,height:0,crop:false,quality:60,callback:function(g,d,e,c){$("<img>").load(function(){$(this).appendTo(".msg-image");
}).attr("src",g).attr("id","pic");var i=new FormData();var h=$.canvasResize("dataURLtoBlob",g);h.name=b.name;if(c){i.append($("input").attr("name"),b,$("input[type=file]")[0].files[0].name);
}else{i.append($("input").attr("name"),h,$("input[type=file]")[0].files[0].name);}i.append("op","uploadphoto");i.append("topicid","0");i.append("pic_title","from wx");
i.append("m_auth",$("#auth").val());$.ajax({url:"http://www.familyday.com.cn/dapi/cp.php?ac=upload",type:"POST",data:i,dataType:"json",contentType:false,processData:false,beforeSend:function(f){f.setRequestHeader("pragma","no-cache");
},xhr:function(){var f=new window.XMLHttpRequest();f.upload.addEventListener("progress",function(j){if(j.lengthComputable){var k=Math.ceil((j.loaded/j.total)*100);
$("#pbar").css({width:k+"%"}).html(k+"%");}},false);return f;}}).done(function(f){if(f.error==0){$("#picid").val(f.data.picid);console.log(f.data.picid);
$("#pbar").html("完成");}else{$("#pbar").html("失败");}});}});});$("#select-choice-1").change(function(){$("#tagid").val($("#select-choice-1").val());});$("#select-choice-2").change(function(){window.location.href=$("#select-choice-2").val();
});});