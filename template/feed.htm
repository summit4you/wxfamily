<!DOCTYPE HTML>
<html>
<HEAD>
<TITLE>FamilyDay，让一家人团聚</TITLE>
<META name=keywords content=main>
<META name=description content=main>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<META content=no-cache http-equiv=Cache-Control>
<meta charset="utf-8">
<meta name="viewport" content="width=320, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<link rel="stylesheet" href="template/js/jquery.mobile-1.3.0-beta.1.min.css " />
<link rel="stylesheet" href="template/css/jquery.mobile-1.2.0.css" />
<link rel="stylesheet" href="template/css/jquery-mobile-fluid960.min.css" />
<link rel="stylesheet"  href="template/css/styles.css">
<script type="text/javascript" src="template/js/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="template/js/jquery.mobile-1.3.0-beta.1.min.js"></script>
<script type="text/javascript" src="template/js/jquery.retina.js"></script>
<script type="text/javascript" src="template/js/jquery.resizecrop-1.0.3.js"></script>
<script type="text/javascript" src="template/js/jquery.tmpl.min.js"></script>
<script type="text/javascript" src="template/js/util.js"></script>
<script id="feedTemplate" type="text/x-jquery-tmpl">
	<div class="feed" id="feed_{{= id}}_{{= idtype}}" onclick="var href = $('#a_{{= id}}_{{= idtype}}').attr('href');window.location.href = href;">
 		<div class="ui-grid-b pheader">
	 		<div class="ui-block-a avatar">
	 			<img class="retina" src="{{= avatar}}" />
	 		</div>
 			<div class="ui-block-b name">{{= name}}   {{= title}}</div>
 			<div class="ui-block-c">{{= dateline}}</div>
	 	</div>
 		<div class="panel">
 			<div class="ui-grid-a">
 				
 				<div class="ui-block-a content-image"><img class="retina" src="{{= image_1}}" /></div>
 				
 				<div class="ui-block-b content">
 					<div class="subject">
 						{{= subject}}
 					</div>
 					<div class="message">
 						{{html message}}
 					</div>
 				</div>
 				

 				
 			</div>
 			<div class="ui-grid-a bottom" style="display:none">
 				<div class="ui-block-a group"><a data-role="button"  data-theme="a" data-icon="image"/>最爱电影</a></div>
 				<div class="ui-block-b more">
 					<a href="wx.php?do=detail&id={{= id}}&uid={{= uid}}&idtype={{= idtype}}&wxkey=$_GET[wxkey]" data-role="none" data-ajax="false" id="a_{{= id}}_{{= idtype}}">
 						<img class="retina" src="template/css/images/family/btn-more.jpg"/>
 					</a>
 				</div>
 			</div>
 		</div>
			
 		<div class="split">

 		</div>
 		
 	</div>
</script>

<script type="text/javascript">

	function getfeeds2(auth, perpage, page){
		 $.ajax({
	        dataType: "jsonp",
	        url: "http://www.familyday.com.cn/dapi/space.php?do=home&m_auth=" + encodeURIComponent(auth) + "&page=" + page + "&perpage=" + perpage,
	       
	        success: function( data ) {
	          /* Get the movies array from the data */

	          if(data.error==0){
	          	data = data.data;
	          	
	          	if (data.length<=0)
	          		
	          		$('.more-btn').html('没有更多动态了，赶快发布新的动态吧！');
	          	else{
		          	for (var i = 0, len = data.length; i < len; ++i) {
		          		data[i].message = html_entity_decode(data[i].message);
		          		data[i].message = html_entity_decode(data[i].message);
		          		data[i].dateline = date('Y-m-d H:i',data[i].dateline);
		          		if (data[i].image_1=="")
		          		{
		          			data[i].image_1 = "http://www.familyday.com.cn/wx/image/nopic.gif";
		          		}
		          	}
		          	$("#feedTemplate").tmpl(data ).appendTo('#feedlist');
		          	$('#page').val(parseInt($('#page').val())+1);
		          }
	          }else{
	          	alert(data.msg);
	          }
	        }
	      });

	}

	function getfeeds( wxkey, perpage, page ) {
	      $.ajax({
	        dataType: "jsonp",
	        url: "http://www.familyday.com.cn/dapi/space.php?do=wxfeed&wxkey=" + wxkey + "&page=" + page + "&perpage=" + perpage,
	       
	        success: function( data ) {
	          /* Get the movies array from the data */

	          if(data.error==0){
	          	data = data.data;
	          	
	          	if (data.length<=0)
	          		
	          		$('.more-btn').html('没有更多动态了，赶快发布新的动态吧！');
	          	else{
		          	for (var i = 0, len = data.length; i < len; ++i) {
		          		data[i].message = html_entity_decode(data[i].message);
		          		data[i].message = html_entity_decode(data[i].message);
		          		if (data[i].image_1=="")
		          		{
		          			data[i].image_1 = "http://www.familyday.com.cn/wx/image/nopic.gif";
		          		}
		          	}
		          	$("#feedTemplate").tmpl(data ).appendTo('#feedlist');
		          	$('#page').val(parseInt($('#page').val())+1);
		          }
	          }else{
	          	alert(data.msg);
	          }
	        }
	      });
	}

	$(function(){
		 $('#auth').val(localStorage.getItem('auth'));
		// getfeeds($('#wxkey').val(), $('#perpage').val(), $('#page').val());
		getfeeds2($('#auth').val(), $('#perpage').val(), $('#page').val());

		$('.header-logo').onclick(function(){
			window.location.href = "http://www.familyday.com.cn/wx/wx.php?do=feed&wxkey=$_GET[wxkey]";
		});

	})


	
</script>

</head>
<body id="top">
	<div data-role="page" data-theme="a" data-fullscreen="true" id="main">
		<div data-role="header">
			<div class="ui-grid-a header">
				<div class="ui-block-a header-menu"><p>动态</p></div>
				<div class="ui-block-b"><div class="header-logo"><div><img class="retina" src="template/css/images/family/logo.jpg" height="26"/></div></div></div>
			</div>
		</div>
		 <div data-role="content" >
		 	<div id="feedlist">
			</div>

			<div class="more-btn"><a href="javascript:;" onclick="getfeeds2(localStorage.getItem('auth'), $('#perpage').val(), $('#page').val());" data-role="button">更多</a></div>

		 	<input type="hidden" id="wxkey" name="wxkey" value="$_GET[wxkey]"/>
	 		<input type="hidden" id="page" name="page" value="1"/>
	 		<input type="hidden" id="auth" name="auth" value="1"/>
	 		<input type="hidden" id="perpage" name="perpage" value="5"/>
		 </div>
		
    </div>
</body>
</html>